function Mania(t){Scroll.call(this,t),this.scrollSpeed=Mania.SCROLL_SPEED,this.columnStart=(Beatmap.WIDTH-Mania.COLUMN_WIDTH*this.keyCount)/2;for(var i=0;i<this.keyCount;i++)this.Colors[i]=Mania.DEFAULT_COLORS[1&i];var a=this.keyCount/2;1&this.keyCount?this.Colors[0|a]=Mania.DEFAULT_COLORS[2]:this.Colors=this.Colors.slice(0,a).concat(this.Colors.slice(a-1));for(i=0;i<this.HitObjects.length;i++){var e=this.HitObjects[i];e.color=this.Colors[e.column],e.position.x=Mania.COLUMN_WIDTH*e.column,e.position.y=this.scrollAt(e.time),e.endPosition.y=this.scrollAt(e.endTime)}}Mania.prototype=Object.create(Scroll.prototype,{keyCount:{get:function(){return this.CircleSize}},columnSize:{get:function(){return Beatmap.MAX_X/this.keyCount}}}),Mania.prototype.constructor=Mania,Mania.prototype.hitObjectTypes={},Mania.ID=3,Beatmap.modes[Mania.ID]=Mania,Mania.DEFAULT_COLORS=["#5bf","#ccc","#da2"],Mania.COLUMN_START=130,Mania.HIT_POSITION=400,Mania.COLUMN_WIDTH=30;let savedSpeed=window.localStorage.getItem("SCROLL_SPEED");Mania.SCROLL_SPEED=savedSpeed?parseInt(savedSpeed):20,Mania.prototype.calcY=function(t,i){return Mania.HIT_POSITION-(t-i)*this.scrollSpeed*.035},Mania.prototype.update=function(t){t.translate(this.columnStart,0)},Mania.prototype.draw=function(t,i){void 0===this.tmp.first&&(this.tmp.first=0,this.tmp.last=-1,this.tmp.barLine=0);for(var a=this.scrollAt(t);this.tmp.first<this.HitObjects.length&&t>this.HitObjects[this.tmp.first].endTime;)this.tmp.first++;for(;this.tmp.last+1<this.HitObjects.length;){var e=this.HitObjects[this.tmp.last+1];if(this.calcY(e.position.y,a)<-Mania.COLUMN_WIDTH)break;this.tmp.last++}for(;this.tmp.barLine<this.barLines.length&&this.calcY(this.barLines[this.tmp.barLine],a)>Beatmap.MAX_Y;)this.tmp.barLine++;for(var s=this.tmp.barLine;s<this.barLines.length&&this.calcY(this.barLines[s],a)>-Mania.COLUMN_WIDTH;s++){var n=this.calcY(this.barLines[s],a);i.beginPath(),i.moveTo(0,n),i.lineTo(Mania.COLUMN_WIDTH*this.keyCount,n),i.strokeStyle="#fff",i.lineWidth=1,i.stroke()}for(s=this.tmp.first;s<=this.tmp.last;s++){t>(e=this.HitObjects[s]).endTime||e.draw(a,i)}i.clearRect(0,Mania.HIT_POSITION,Beatmap.WIDTH,Beatmap.HEIGHT-Mania.HIT_POSITION)},Mania.prototype.processBG=function(t){"1"===window.localStorage.getItem("BGChange")&&(t.fillStyle="rgba(0, 0, 0, 1.0)",t.fillRect(0,0,t.canvas.width,t.canvas.height)),t.beginPath(),t.rect(this.columnStart,0,Mania.COLUMN_WIDTH*this.keyCount,Beatmap.HEIGHT),t.strokeStyle="#ddd",t.lineWidth=8,t.stroke(),t.fillStyle="#000",t.fill();for(var i=0;i<this.keyCount;i++){var a=this.columnStart+Mania.COLUMN_WIDTH*i;t.beginPath(),t.moveTo(a,0),t.lineTo(a,Mania.HIT_POSITION),t.strokeStyle="#fff",t.lineWidth=1,t.stroke(),t.beginPath(),t.rect(a,Mania.HIT_POSITION,Mania.COLUMN_WIDTH,Beatmap.HEIGHT-Mania.HIT_POSITION),t.fillStyle=this.Colors[i],t.fill(),t.strokeStyle="#fff",t.lineWidth=3,t.stroke()}a=this.columnStart+Mania.COLUMN_WIDTH*this.keyCount;t.beginPath(),t.moveTo(a,0),t.lineTo(a,Mania.HIT_POSITION),t.strokeStyle="#fff",t.lineWidth=1,t.stroke(),t.beginPath(),t.rect(this.columnStart,Mania.HIT_POSITION,Mania.COLUMN_WIDTH*this.keyCount,Mania.COLUMN_WIDTH/3),t.strokeStyle="#fff",t.lineWidth=2,t.stroke(),t.fillStyle="#568",t.fill()};
