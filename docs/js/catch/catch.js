function Catch(t){Beatmap.call(this,t);let e=window.localStorage.getItem("DefaultColor");this.useDefaultColor=e?parseInt(e):0;let a=window.localStorage.getItem("ColorChange");this.colorChange=a?parseInt(a):0,this.Colors.length&&!this.useDefaultColor?this.Colors.push(this.Colors.shift()):this.Colors=Catch.DEFAULT_COLORS,this.circleRadius=this.circleDiameter/2-4,this.smallRadius=this.circleRadius/2,this.tinyRadius=this.smallRadius/2,this.bananaRadius=.8*this.circleRadius,this.CATCHER_HEIGHT=Beatmap.HEIGHT/8,this.FALLOUT_TIME=this.CATCHER_HEIGHT/Beatmap.HEIGHT*this.approachTime;for(var i=1,h=-1,s=1,l=0;l<this.HitObjects.length;l++){let t=this.HitObjects[l];t instanceof BananaShower?s=1:(t.newCombo||s)&&(i=1,h=(h+1+t.comboSkip)%this.Colors.length,s=0),t.combo=i++,t.color=this.colorChange?this.Colors[l%this.Colors.length]:this.Colors[h],(t instanceof JuiceStream||t instanceof BananaShower)&&t.buildNested()}this.CATCHER_BASE_SIZE=106.75,this.ALLOWED_CATCH_RANGE=.8,this.HYPER_DASH_TRANSITION_DURATION=180,this.calculateScale=1-.7*(this.CircleSize-5)/5,this.catchWidth=this.CATCHER_BASE_SIZE*Math.abs(this.calculateScale)*this.ALLOWED_CATCH_RANGE,this.halfCatcherWidth=this.catchWidth/2,this.halfCatcherWidth/=this.ALLOWED_CATCH_RANGE,this.BASE_DASH_SPEED=1,this.BASE_WALK_SPEED=.5,this.RNG_SEED=1337;var c=new LegacyRandom(this.RNG_SEED);for(l=0;l<this.HitObjects.length;l++){let t=this.HitObjects[l];t instanceof BananaShower?t.nested.forEach(t=>{t.x+=c.NextDouble()*Beatmap.MAX_X,c.Next(),c.Next(),c.Next()}):t instanceof JuiceStream&&t.nested.forEach(t=>{"TinyDroplet"===t.type?t.x+=Math.clamp(c.Next(-20,20),-t.x,Beatmap.MAX_X-t.x):"Droplet"===t.type&&c.Next()})}this.palpableObjects=[],this.fullCatchObjects=[];for(l=0;l<this.HitObjects.length;l++){let t=this.HitObjects[l];if(t instanceof Fruit){let e=new PalpableCatchHitObject({type:"Fruit",time:t.time,x:t.position.x,color:t.color,radius:this.circleRadius},this);this.palpableObjects.push(e),this.fullCatchObjects.push(e)}else t instanceof BananaShower?t.nested.forEach(t=>{this.fullCatchObjects.push(t)}):t instanceof JuiceStream&&t.nested.forEach(t=>{this.fullCatchObjects.push(t),"TinyDroplet"!=t.type&&this.palpableObjects.push(t)})}this.palpableObjects.sort((t,e)=>t.time-e.time),this.fullCatchObjects.sort((t,e)=>t.time-e.time);let o=0,r=this.halfCatcherWidth;for(let t=0;t<this.palpableObjects.length-1;t++){var p=this.palpableObjects[t],n=this.palpableObjects[t+1];p.hyperDash=!1;let e=n.x>p.x?1:-1,a=n.time-p.time-1e3/60/4,i=Math.abs(n.x-p.x)-(o==e?r:this.halfCatcherWidth),h=a*this.BASE_DASH_SPEED-i;h<0?(p.hyperDash=!0,r=this.halfCatcherWidth):r=Math.clamp(h,0,this.halfCatcherWidth),o=e}}Catch.prototype=Object.create(Beatmap.prototype,{approachTime:{get:function(){return this.ApproachRate<5?1800-120*this.ApproachRate:1200-150*(this.ApproachRate-5)}},circleDiameter:{get:function(){return 108.848-8.9646*this.CircleSize}}}),Catch.prototype.constructor=Catch,Catch.prototype.hitObjectTypes={},Catch.ID=2,Beatmap.modes[Catch.ID]=Catch,Catch.DEFAULT_COLORS=["rgb(255,210,128)","rgb(128,255,128)","rgb(128,191,255)","rgb(191,128,255)"],Catch.prototype.update=function(t){t.translate((Beatmap.WIDTH-Beatmap.MAX_X)/2,(Beatmap.HEIGHT-Beatmap.MAX_Y)/2)},Catch.prototype.draw=function(t,e){for(void 0===this.tmp.first&&(this.tmp.first=0,this.tmp.last=-1);this.tmp.first<this.fullCatchObjects.length;){if(t<=(i=this.fullCatchObjects[this.tmp.first]).time+this.FALLOUT_TIME)break;this.tmp.first++}for(;this.tmp.last+1<this.fullCatchObjects.length&&t>=this.fullCatchObjects[this.tmp.last+1].time-1.1*this.approachTime;)this.tmp.last++;for(var a=this.tmp.last;a>=this.tmp.first;a--){var i;t>(i=this.fullCatchObjects[a]).time+this.FALLOUT_TIME||i.draw(t,e)}},Catch.prototype.processBG=function(t){"1"===window.localStorage.getItem("BGChange")&&(t.fillStyle="rgba(0, 0, 0, 1.0)",t.fillRect(0,0,t.canvas.width,t.canvas.height)),t.beginPath(),t.moveTo(0,Beatmap.HEIGHT-this.CATCHER_HEIGHT),t.lineTo(Beatmap.WIDTH,Beatmap.HEIGHT-this.CATCHER_HEIGHT),t.strokeStyle="#fff",t.lineWidth=2,t.stroke();let e=this.catchWidth/60;t.beginPath(),t.rect(Beatmap.WIDTH/2-this.catchWidth/2,Beatmap.HEIGHT-this.CATCHER_HEIGHT-e/2,this.catchWidth,e),t.strokeStyle="#fff",t.lineWidth=8,t.stroke(),t.fillStyle="#fff",t.fill()};
